# å®éªŒæ€§åŠŸèƒ½: TCP å¹¶å‘è¿æ¥ (æé«˜æ¡æ‰‹æˆåŠŸç‡)
experimental:
  tcp-concurrent: true

# === DNS é…ç½® ===
dns:
  enable: true
  ipv6: true
  prefer-h3: true            # ä¼˜å…ˆä½¿ç”¨ DoH çš„ HTTP/3
  use-system-hosts: true     # ä½¿ç”¨ç³»ç»Ÿ hosts æ–‡ä»¶
  enhanced-mode: fake-ip     # å¢å¼ºæ¨¡å¼: Fake-IP (é€Ÿåº¦æœ€å¿«)
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter-mode: blacklist
  respect-rules: true        # ä»…å½“è§„åˆ™æœªå‘½ä¸­(éœ€è¦IPåŒ¹é…)æ—¶æ‰è¿›è¡ŒDNSè§£æ

  # === é»˜è®¤ DNS (è§£æå›½å¤–åŸŸå) ===
  nameserver:
    - "https://1.1.1.1/dns-query"
    - "https://8.8.8.8/dns-query"
    - "https://dns.sb/dns-query"

  # === å¤‡ç”¨ DNS (Fallback) ===
  fallback:
    - "https://cloudflare-dns.com/dns-query"
    - "https://dns.google/dns-query"
    - "tls://8.8.4.4"
    - "tls://1.1.1.1"

  # === å¤‡ç”¨ DNS å¯ç”¨æ¡ä»¶ (é˜²æ±¡æŸ“) ===
  fallback-filter:
    geoip: true
    geoip-code: CN
    ipcidr:
      - 240.0.0.0/4
    domain:
      - "+.google.com"
      - "+.facebook.com"
      - "+.twitter.com"
      - "+.youtube.com"

  # === æ ¸å¿ƒç­–ç•¥: DNS åˆ†æµ ===
  nameserver-policy:
    # 1. å¾®è½¯/NTP/STUN -> èµ°æœ¬åœ°ç³»ç»Ÿ DNS (ç¡®ä¿è¿é€šæ€§æ£€æµ‹é€šè¿‡)
    "dns.msftncsi.com": system
    "www.msftncsi.com": system
    "www.msftconnecttest.com": system
    "pool.ntp.org": system
    "time.*.com": system
    "stun.*": system

    # 2. è‹¹æœ/æ¸¸æˆ/å›½å†… -> é˜¿é‡Œ DNS
    "geosite:apple,category-games@cn,cn,private":
      - tls://223.5.5.5
      - https://223.5.5.5/dns-query

  # === ä»£ç†èŠ‚ç‚¹ DNS (è§£ææœºåœºåŸŸå) ===
  proxy-server-nameserver:
    - "223.5.5.5"
    - "119.29.29.29"

  # === Fake-IP è¿‡æ»¤åˆ—è¡¨ (è¿”å›çœŸå® IP) ===
  # ä½œç”¨: è§£å†³ç”± Fake-IP å¯¼è‡´çš„å±€åŸŸç½‘æ— æ³•è®¿é—®ã€æ¸¸æˆ NAT ç±»å‹ä¸¥æ ¼ç­‰é—®é¢˜
  fake-ip-filter:
    # --- å±€åŸŸç½‘ & è·¯ç”±å™¨ ---
    - +.lan
    - +.local
    - +.internal
    - +.localdomain
    - +.home.arpa
    - +.bogon
    - +.m2m
    # --- AdGuard & å®‰å…¨ ---
    - injections.adguard.org
    - local.adguard.org
    # --- Windows ç½‘ç»œæ¢æµ‹ ---
    - dns.msftncsi.com
    - www.msftncsi.com
    - www.msftconnecttest.com
    # --- Google/Android ç½‘ç»œæ¢æµ‹ ---
    - connectivitycheck.gstatic.com
    - connectivitycheck.android.com
    # --- æ¸¸æˆ STUN & NAT ä¼˜åŒ– ---
    - "*.srv.nintendo.net"
    - "*.stun.playstation.net"
    - xbox.*.microsoft.com
    - "*.xboxlive.com"
    - "*.battlenet.com.cn"
    - "*.turn.twilio.com"
    - "*.stun.twilio.com"
    - stun.syncthing.net
    - stun.*
    # --- NTP æ—¶é—´åŒæ­¥ ---
    - pool.ntp.org
    - time.windows.com
    - time.nist.gov
    - time.apple.com
    # --- å¼€å‘è€… / æ³›åŸŸåæ˜ å°„ ---
    - 127.0.0.1.sslip.io
    - 127.atlas.skk.moe
    - 127.*.*.*.sslip.io
    - 127-*-*-*.sslip.io
    - "*.127.*.*.*.sslip.io"
    - "*-127-*-*-*.sslip.io"
    - 127.*.*.*.nip.io
    - 127-*-*-*.nip.io
    - "*.127.*.*.*.nip.io"
    - "*-127-*-*-*.nip.io"

# === åŸŸåå—…æ¢ ===
sniffer:
  enable: true
  sniff:
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
  skip-domain:
    - "Mijia Cloud"
    - "+.push.apple.com"

# === GeoData æ¨¡å¼ ===
geodata-mode: true
geox-url:
  geoip: https://fastly.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geoip.dat
  geosite: https://fastly.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geosite.dat
  mmdb: https://fastly.jsdelivr.net/gh/Loyalsoldier/geoip@release/Country.mmdb
  asn: https://fastly.jsdelivr.net/gh/Loyalsoldier/geoip@release/GeoLite2-ASN.mmdb

# === åˆ†æµç»„ ===
proxy-groups:
  - name: é€‰æ‹©ä»£ç†
    icon: https://fastly.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Proxy.png
    type: select
    proxies:
      - é¦™æ¸¯èŠ‚ç‚¹
      - å°æ¹¾èŠ‚ç‚¹
      - æ–°åŠ å¡èŠ‚ç‚¹
      - æ—¥æœ¬èŠ‚ç‚¹
      - ç¾å›½èŠ‚ç‚¹
      - æ‰‹åŠ¨é€‰æ‹©
      - å…¶ä»–å›½å®¶èŠ‚ç‚¹
      - DIRECT

  - name: æ‰‹åŠ¨é€‰æ‹©
    icon: https://fastly.jsdelivr.net/gh/shindgewongxj/WHATSINStash@master/icon/select.png
    include-all: true
    type: select

  - name: YouTube
    icon: https://fastly.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/YouTube.png
    type: select
    proxies:
      - é¦™æ¸¯èŠ‚ç‚¹
      - å°æ¹¾èŠ‚ç‚¹
      - æ–°åŠ å¡èŠ‚ç‚¹
      - æ—¥æœ¬èŠ‚ç‚¹
      - ç¾å›½èŠ‚ç‚¹
      - æ‰‹åŠ¨é€‰æ‹©
      - å…¶ä»–å›½å®¶èŠ‚ç‚¹

  - name: Telegram
    icon: https://fastly.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Telegram.png
    type: select
    proxies:
      - é¦™æ¸¯èŠ‚ç‚¹
      - å°æ¹¾èŠ‚ç‚¹
      - æ–°åŠ å¡èŠ‚ç‚¹
      - æ—¥æœ¬èŠ‚ç‚¹
      - ç¾å›½èŠ‚ç‚¹
      - æ‰‹åŠ¨é€‰æ‹©
      - å…¶ä»–å›½å®¶èŠ‚ç‚¹

  - name: å¹¿å‘Šæ‹¦æˆª
    icon: https://fastly.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/AdBlack.png
    type: select
    proxies:
      - REJECT
      - REJECT-DROP

  # === è‡ªåŠ¨æµ‹é€Ÿç»„ (ç»Ÿä¸€é…ç½®: ä¼˜åŒ–æµ‹é€Ÿæœºåˆ¶) ===
  - name: é¦™æ¸¯èŠ‚ç‚¹
    icon: https://fastly.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Hong_Kong.png
    include-all: true
    filter: (?i)é¦™æ¸¯|æ¸¯|HK|hk|Hong Kong|HongKong|hongkong|ğŸ‡­ğŸ‡°
    #exclude-filter: 0\.[0-5]|ä½å€ç‡|çœæµ|å¤§æµé‡|å®éªŒæ€§
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    tolerance: 50
    unified-delay: true  # å¼€å¯ç»Ÿä¸€å»¶è¿Ÿ
    lazy: false          # é¦™æ¸¯èŠ‚ç‚¹é€šå¸¸ä½œä¸ºä¸»åŠ›ï¼Œä¸å·æ‡’ï¼Œä¿æŒæµ‹é€Ÿæ´»è·ƒ

  - name: å°æ¹¾èŠ‚ç‚¹
    icon: https://fastly.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Taiwan.png
    include-all: true
    filter: (?i)å°|æ–°åŒ—|å½°åŒ–|TW|Taiwan|ğŸ‡¹ğŸ‡¼
   # exclude-filter: 0\.[0-5]|ä½å€ç‡|çœæµ|å¤§æµé‡|å®éªŒæ€§
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    tolerance: 50
    unified-delay: true
    lazy: true

  - name: æ–°åŠ å¡èŠ‚ç‚¹
    icon: https://fastly.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Singapore.png
    include-all: true
    filter: (?i)æ–°åŠ å¡|å¡|ç‹®åŸ|SG|Singapore|ğŸ‡¸ğŸ‡¬
    #exclude-filter: 0\.[0-5]|ä½å€ç‡|çœæµ|å¤§æµé‡|å®éªŒæ€§
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    tolerance: 50
    unified-delay: true
    lazy: true

  - name: æ—¥æœ¬èŠ‚ç‚¹
    icon: https://fastly.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Japan.png
    include-all: true
    filter: (?i)æ—¥æœ¬|å·æ—¥|ä¸œäº¬|å¤§é˜ª|æ³‰æ—¥|åŸ¼ç‰|æ²ªæ—¥|æ·±æ—¥|JP|Japan|ğŸ‡¯ğŸ‡µ
   # exclude-filter: 0\.[0-5]|ä½å€ç‡|çœæµ|å¤§æµé‡|å®éªŒæ€§
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    tolerance: 50
    unified-delay: true
    lazy: true

  - name: ç¾å›½èŠ‚ç‚¹
    icon: https://fastly.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/United_States.png
    include-all: true
    filter: (?i)ç¾å›½|ç¾|US|United States|ğŸ‡ºğŸ‡¸
   # exclude-filter: 0\.[0-5]|ä½å€ç‡|çœæµ|å¤§æµé‡|å®éªŒæ€§
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    tolerance: 50
    unified-delay: true
    lazy: true

  - name: å…¶ä»–å›½å®¶èŠ‚ç‚¹
    icon: https://fastly.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Bot.png
    include-all: true
    exclude-filter: "(?i)é¦™æ¸¯|Hong Kong|HK|æ—¥æœ¬|Japan|JP|å°æ¹¾|Taiwan|TW|ä¸­å›½|China|CN|ç¾å›½|United States|US|æ–°åŠ å¡|Singapore|SG|å‰©ä½™|åˆ°æœŸ|æ’é™¤|è¿‡æ»¤"
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    tolerance: 50
    unified-delay: true
    lazy: true

  - name: GLOBAL
    icon: https://fastly.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Global.png
    include-all: true
    type: select
    proxies:
      - é€‰æ‹©ä»£ç†
      - æ‰‹åŠ¨é€‰æ‹©
      - Telegram
      - YouTube
      - å¹¿å‘Šæ‹¦æˆª
      - é¦™æ¸¯èŠ‚ç‚¹
      - å°æ¹¾èŠ‚ç‚¹
      - æ–°åŠ å¡èŠ‚ç‚¹
      - æ—¥æœ¬èŠ‚ç‚¹
      - ç¾å›½èŠ‚ç‚¹
      - å…¶ä»–å›½å®¶èŠ‚ç‚¹

# === åˆ†æµè§„åˆ™æä¾› ===
rule-providers:
  ADBlock:
    type: http
    behavior: domain
    format: mrs
    interval: 86400
    url: https://adrules.top/adrules-mihomo.mrs
    path: ./ruleset/ADBlock.mrs
  EHentai:
    type: http
    behavior: classical
    format: text
    interval: 86400
    url: https://fastly.jsdelivr.net/gh/powerfullz/override-rules@master/ruleset/EHentai.list
    path: ./ruleset/EHentai.list
  SteamFix:
    type: http
    behavior: classical
    format: text
    interval: 86400
    url: https://fastly.jsdelivr.net/gh/powerfullz/override-rules@master/ruleset/SteamFix.list
    path: ./ruleset/SteamFix.list
  GoogleFCM:
    type: http
    behavior: classical
    format: text
    interval: 86400
    url: https://fastly.jsdelivr.net/gh/powerfullz/override-rules@master/ruleset/FirebaseCloudMessaging.list
    path: ./ruleset/FirebaseCloudMessaging.list
  AdditionalFilter:
    type: http
    behavior: classical
    format: text
    interval: 86400
    url: https://fastly.jsdelivr.net/gh/powerfullz/override-rules@master/ruleset/AdditionalFilter.list
    path: ./ruleset/AdditionalFilter.list
  DMM:
    type: http
    behavior: classical
    format: text
    interval: 86400
    url: https://fastly.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/DMM/DMM.list
    path: ./DMM/DMM.list

# === åˆ†æµè§„åˆ™ ===
rules:
  # 0. é˜»æ–­ QUIC: å¼ºåˆ¶ä½¿ç”¨ TCP åè®®ï¼Œä¿è¯æµé‡èƒ½è¢«ä»£ç†æ­£ç¡®å—…æ¢å’ŒåŠ é€Ÿ
  - AND,(DST-PORT,443),(NETWORK,UDP),REJECT
  
  # 1. å¹¿å‘Šæ‹¦æˆª
  - RULE-SET,ADBlock,å¹¿å‘Šæ‹¦æˆª
  - RULE-SET,AdditionalFilter,å¹¿å‘Šæ‹¦æˆª

  # 2. ç‰¹æ®Šåº”ç”¨
  - RULE-SET,EHentai,ç¾å›½èŠ‚ç‚¹
  - RULE-SET,DMM,æ—¥æœ¬èŠ‚ç‚¹
  - RULE-SET,GoogleFCM,é€‰æ‹©ä»£ç†
  - RULE-SET,SteamFix,DIRECT

  # 3. è‡ªå®šä¹‰åŸŸå
  - DOMAIN-SUFFIX,hxcy.top,æ–°åŠ å¡èŠ‚ç‚¹


  # 4. GeoSite è§„åˆ™ (åŸŸåç±»)
  - GEOSITE,TELEGRAM,Telegram
  - GEOSITE,YOUTUBE,YouTube
  - GEOSITE,GFW,é€‰æ‹©ä»£ç†
  - GEOSITE,BILIBILI,DIRECT
  - GEOSITE,MICROSOFT@CN,DIRECT
  - GEOSITE,APPLE,DIRECT
  - GEOSITE,CN,DIRECT
  - GEOSITE,PRIVATE,DIRECT

  # 5. GeoIP è§„åˆ™ (IPç±»ï¼Œä½œä¸ºå…œåº•)
  - GEOIP,TELEGRAM,Telegram
  - GEOIP,CN,DIRECT
  - GEOIP,PRIVATE,DIRECT

  # 6. æœ€ç»ˆå…œåº•
  - MATCH,é€‰æ‹©ä»£ç†
